-- MAP OBJECT --

	object_const_def
	const_export SILPHCO8F_SILPH_WORKER_M
	const_export SILPHCO8F_ROCKET1
	const_export SILPHCO8F_SCIENTIST
	const_export SILPHCO8F_ROCKET2

SilphCo8F_Object:
	db $2e ; border block

	def_warp_events
	warp_event 16,  0, SILPH_CO_9F, 2
	warp_event 14,  0, SILPH_CO_7F, 1
	warp_event 18,  0, SILPH_CO_ELEVATOR, 1
	warp_event  3, 11, SILPH_CO_8F, 7
	warp_event  3, 15, SILPH_CO_2F, 5
	warp_event 11,  5, SILPH_CO_2F, 6
	warp_event 11,  9, SILPH_CO_8F, 4

	def_bg_events

	def_object_events
	object_event  4,  2, SPRITE_SILPH_WORKER_M, STAY, NONE, TEXT_SILPHCO8F_SILPH_WORKER_M
	object_event 19,  2, SPRITE_ROCKET, STAY, LEFT, TEXT_SILPHCO8F_ROCKET1, OPP_ROCKET, 35
	object_event 10,  2, SPRITE_SCIENTIST, STAY, DOWN, TEXT_SILPHCO8F_SCIENTIST, OPP_SCIENTIST, 9
	object_event 12, 15, SPRITE_ROCKET, STAY, RIGHT, TEXT_SILPHCO8F_ROCKET2, OPP_ROCKET, 36

	def_warps_to SILPH_CO_8F


-- MAP HEADER --

	map_header SilphCo8F, SILPH_CO_8F, FACILITY, 0
	end_map_header


-- MAP TEXT --

__SilphCo8FSilphWorkerMThanksForSavingUsText::
	text "I wonder if SILPH"
	line "is finished..."
	done

_SilphCo8FSilphWorkerMThanksForSavingUsText::
	text "Thanks for saving"
	line "us!"
	done

_SilphCo8FRocket1BattleText::
	text "That's as far as"
	line "you'll go!"
	done

_SilphCo8FRocket1EndBattleText::
	text "Not"
	line "enough grit!"
	prompt

_SilphCo8FRocket1AfterBattleText::
	text "If you don't turn"
	line "back, I'll call"
	cont "for backup!"
	done

_SilphCo8FScientistBattleText::
	text "You're causing us"
	line "problems!"
	done

_SilphCo8FScientistEndBattleText::
	text "Huh?"
	line "I lost?"
	prompt

_SilphCo8FScientistAfterBattleText::
	text "So, what do you"
	line "think of SILPH"
	cont "BUILDING's maze?"
	done

_SilphCo8FRocket2BattleText::
	text "I am one of the 4"
	line "ROCKET BROTHERS!"
	done

_SilphCo8FRocket2EndBattleText::
	text "Whoo!"
	line "Oh brothers!"
	prompt

_SilphCo8FRocket2AfterBattleText::
	text "I'll leave you up"
	line "to my brothers!"
	done


-- MAP SCRIPT --

SilphCo8F_Script:
	call SilphCo8FGateCallbackScript
	call EnableAutoTextBoxDrawing
	ld hl, SilphCo8TrainerHeaders
	ld de, SilphCo8F_ScriptPointers
	ld a, [wSilphCo8FCurScript]
	call ExecuteCurMapScriptInTable
	ld [wSilphCo8FCurScript], a
	ret

SilphCo8FGateCallbackScript:
	ld hl, wCurrentMapScriptFlags
	bit 5, [hl]
	res 5, [hl]
	ret z
	ld hl, .GateCoordinates
	call SilphCo8F_SetCardKeyDoorYScript
	call SilphCo8F_UnlockedDoorEventScript
	CheckEvent EVENT_SILPH_CO_8_UNLOCKED_DOOR
	ret nz
	ld a, $5f
	ld [wNewTileBlockID], a
	lb bc, 4, 3
	predef_jump ReplaceTileBlock

.GateCoordinates:
	dbmapcoord  3,  4
	db -1 ; end

SilphCo8F_SetCardKeyDoorYScript:
	push hl
	ld hl, wCardKeyDoorY
	ld a, [hli]
	ld b, a
	ld a, [hl]
	ld c, a
	xor a
	ldh [hUnlockedSilphCoDoors], a
	pop hl
.loop_check_doors
	ld a, [hli]
	cp $ff
	jr z, .exit_loop
	push hl
	ld hl, hUnlockedSilphCoDoors
	inc [hl]
	pop hl
	cp b
	jr z, .check_y_coord
	inc hl
	jr .loop_check_doors
.check_y_coord
	ld a, [hli]
	cp c
	jr nz, .loop_check_doors
	ld hl, wCardKeyDoorY
	xor a
	ld [hli], a
	ld [hl], a
	ret
.exit_loop
	xor a
	ldh [hUnlockedSilphCoDoors], a
	ret

SilphCo8F_UnlockedDoorEventScript:
	ldh a, [hUnlockedSilphCoDoors]
	and a
	ret z
	SetEvent EVENT_SILPH_CO_8_UNLOCKED_DOOR
	ret

SilphCo8F_ScriptPointers:
	def_script_pointers
	dw_const CheckFightingMapTrainers,              SCRIPT_SILPHCO8F_DEFAULT
	dw_const DisplayEnemyTrainerTextAndStartBattle, SCRIPT_SILPHCO8F_START_BATTLE
	dw_const EndTrainerBattle,                      SCRIPT_SILPHCO8F_END_BATTLE

SilphCo8F_TextPointers:
	def_text_pointers
	dw_const SilphCo8FSilphWorkerMText, TEXT_SILPHCO8F_SILPH_WORKER_M
	dw_const SilphCo8FRocket1Text,      TEXT_SILPHCO8F_ROCKET1
	dw_const SilphCo8FScientistText,    TEXT_SILPHCO8F_SCIENTIST
	dw_const SilphCo8FRocket2Text,      TEXT_SILPHCO8F_ROCKET2

SilphCo8TrainerHeaders:
	def_trainers 2
SilphCo8TrainerHeader0:
	trainer EVENT_BEAT_SILPH_CO_8F_TRAINER_0, 4, SilphCo8FRocket1BattleText, SilphCo8FRocket1EndBattleText, SilphCo8FRocket1AfterBattleText
SilphCo8TrainerHeader1:
	trainer EVENT_BEAT_SILPH_CO_8F_TRAINER_1, 4, SilphCo8FScientistBattleText, SilphCo8FScientistEndBattleText, SilphCo8FScientistAfterBattleText
SilphCo8TrainerHeader2:
	trainer EVENT_BEAT_SILPH_CO_8F_TRAINER_2, 4, SilphCo8FRocket2BattleText, SilphCo8FRocket2EndBattleText, SilphCo8FRocket2AfterBattleText
	db -1 ; end

SilphCo8FSilphWorkerMText:
	text_asm
	CheckEvent EVENT_BEAT_SILPH_CO_GIOVANNI
	ld hl, .ThanksForSavingUsText
	jr nz, .beat_giovanni
	ld hl, .SilphIsFinishedText
.beat_giovanni
	call PrintText
	jp TextScriptEnd

.SilphIsFinishedText:
	text_far __SilphCo8FSilphWorkerMThanksForSavingUsText
	text_end

.ThanksForSavingUsText:
	text_far _SilphCo8FSilphWorkerMThanksForSavingUsText
	text_end

SilphCo8FRocket1Text:
	text_asm
	ld hl, SilphCo8TrainerHeader0
	call TalkToTrainer
	jp TextScriptEnd

SilphCo8FScientistText:
	text_asm
	ld hl, SilphCo8TrainerHeader1
	call TalkToTrainer
	jp TextScriptEnd

SilphCo8FRocket2Text:
	text_asm
	ld hl, SilphCo8TrainerHeader2
	call TalkToTrainer
	jp TextScriptEnd

SilphCo8FRocket1BattleText:
	text_far _SilphCo8FRocket1BattleText
	text_end

SilphCo8FRocket1EndBattleText:
	text_far _SilphCo8FRocket1EndBattleText
	text_end

SilphCo8FRocket1AfterBattleText:
	text_far _SilphCo8FRocket1AfterBattleText
	text_end

SilphCo8FScientistBattleText:
	text_far _SilphCo8FScientistBattleText
	text_end

SilphCo8FScientistEndBattleText:
	text_far _SilphCo8FScientistEndBattleText
	text_end

SilphCo8FScientistAfterBattleText:
	text_far _SilphCo8FScientistAfterBattleText
	text_end

SilphCo8FRocket2BattleText:
	text_far _SilphCo8FRocket2BattleText
	text_end

SilphCo8FRocket2EndBattleText:
	text_far _SilphCo8FRocket2EndBattleText
	text_end

SilphCo8FRocket2AfterBattleText:
	text_far _SilphCo8FRocket2AfterBattleText
	text_end
